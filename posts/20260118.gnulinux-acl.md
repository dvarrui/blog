[<< back](../README.md)

# Las ACL en GNU/Linux

Las ACL son listas de control de accesos. Es otra forma de asignar permisos con otro nivel de detalle similar al empleado en los Routers Cisco y en el sistema de ficheros NTFS.

Hay que instalar el paquete `acl`, que contiene los comandos:
* `getfacl`, consultar las ACL.
* `setfacl`, modificar las ACL.

# 1. Introducción

## 1.1 Ejemplo

Veamos un ejemplo del clásico permiso user-group-others:

```bash
$ vdir
total 4
-rwxr-xr-x 1 david david 19 2011-02-03 22:52 holamundo*
```

Ahora veamos un ejemplo de permisos ACL con getfacl:
```bash
$ getfacl holamundo
# file: holamundo
# owner: david
# group: david
user::rwx
group::r-x
other::r-x
```

## 1.2 Activación manual

ACL añade más detalle al sistema clásico de permisos, pero para poder usar el comando `setfacl`, los ficheros deben estar en un sistema de ficheros montado con la opción `acl`. Por ejemplo si intentamos establecer permisos ACL sin haber activado antes el sistema de ficheros en modo `acl` veremos un error como este: `setfacl: holamundo: La operación no está soportada`.

Si quisiéramos habilitar ACL de manera temporal para la sesión actual, ejecutamos el siguiente comando:

```bash
mount /dev/partition -o defaults,acl /punto/de/montaje
```

Ahora podemos usar el comando mount sin parámetros para verificar que todo está montado según nuestras intenciones. Ya podemos usar el comando `setfacl` para añadir permiso de lectura
al usuario `invitado` sobre el fichero `holamundo`.

```
$ vdir
total 4
-rwxr-xr-x 1 david david 19 2011-02-03 22:52 holamundo*
$ setfacl -m u:invitado:r holamundo
```

Explicación de los parámetros del comando:

| Parámetro | Descripción |
| --------- | ----------- |
| setfacl   | Comando para poner permisos ACL |
| -m        | Modificar ACL |
| u         | Modificar un usuario  |
| invitado  | Usuario invitado |
| r         | Permiso de lectura |
| holamundo | Nombre del fichero |

* Ejecutamos `getfacl` para comprobar que el resultado es el que esperábamos.

```bash
$ getfacl holamundo
# file: holamundo
# owner: david
# group: david
user::rwx
user:invitado:r--
group::r-x
mask::r-x
other::r-x
```

> Para quitar los permisos hacemos `setfacl -x u:invitado holamundo`. Sencillo, ¿verdad?

## 1.3 Activación automática

Para que se habiliten las ACL en la partición que elijamos de forma automática al iniciar el equipo, debemos modificar el fichero `/etc/fstab`, y luego reiniciar el equipo. Este fichero define que particiones serán montadas automáticamente al iniciar el sistema, y con qué parámetros se realizará dicho montaje automático.

Ejemplo de como editar el fichero `/etc/fstab` para activar las ACL en las particiones deseadas de manera permanente:

`/dev/partición  /punto/de/montaje ext2 defaults,acl 0 2`

> En este ejemplo se asume que la partición que estamos montando tiene formato `ext2`, pero podría ser cualquier otro (Podemos usar el comando `df -hT` para ver tipo de formato que tiene cada partición).

Tras haber modificado `/etc/fstab`, es necesario reiniciar la máquina (comando reboot) para que surtan efecto los cambios.

# ANEXO

> Enlace de interés:
> * [Actividad: permisos ACL en Debian](https://github.com/dvarrui/libro-de-actividades/blob/master/actividades/sistemas.2/permisos/permisos-acl-debian.md)
> * Repo paquete ACL: https://cgit.git.savannah.gnu.org/cgit/acl.git
>     * git://git.git.savannah.gnu.org/acl.git
>     * https://https.git.savannah.gnu.org/git/acl.git
>     * ssh://git.savannah.gnu.org/srv/git/acl.git